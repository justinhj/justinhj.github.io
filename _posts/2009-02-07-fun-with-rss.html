---
layout: post
title: Fun with RSS
date: '2009-02-07T22:51:00.000-08:00'
author: Justin
tags: [rss, emacs, xml, parsing, bbc-news, emacs-lisp]
modified_time: '2009-02-07T23:04:41.309-08:00'
blogger_id: tag:blogger.com,1999:blog-4777243148323391813.post-140872619931223682
blogger_orig_url: http://justinsboringpage.blogspot.com/2009/02/fun-with-rss.html
---

Today I've been playing around with emacs, and one of the things I've wanted to write is something to grab a web page, do some manipluations to it and dump that to a buffer. <br /><br />So what I've got going is two things that are not quite joined up yet. Firstly grabbing some URL and sticking it in a buffer... <br /><br /><pre><br />(defun url-to-buffer(url)<br />  (interactive "sEnter site url : ")<br />  (let ((buffer (get-buffer-create "*url-to-buffer*")))<br />    (shell-command (format "c:/coreutils/bin/wget.exe -q -O - %s" url) buffer)))<br /></pre><br /><br />As you can see I'm using windows here, but as long as you have a path to wget this should work. I'm simply running wget and capturing the output to a buffer. <br /><br />So running that on BBC's news RSS feed, I then saved it to a file called bbc.xml.<br /><br />Since this is an XML file I can parse it without any effort using xml.el. Here is some code that walks through the items in the RSS file and prints them out in human readable format (ie: not XML) into a buffer. <br /><br />There is some helpful info about xml.el here<br /><br /><a href="http://www.emacswiki.org/emacs/XmlParserExamples">http://www.emacswiki.org/emacs/XmlParserExamples</a><br /><br />which was neccesary to figure to figure out the syntax to grab the text from a tag. I wrote helper function to go from a node to the text for that node, since the syntax is quite verbose:<br /><br /><pre><br />(defun get-item(tag node)<br />  (let ((child-node (car (xml-get-children node tag))))<br />    (car (xml-node-children child-node))))<br /></pre><br /><br />This lets you go from a tag name (eg title) and a node that you parsed from the xml file, to the item. <br /><br /><pre><br />(defun parse-rss(filename)<br />  (interactive "fRss file :")<br />  (let ((parsed-xml <br />  (xml-parse-file filename))<br /> (buffer<br />  (get-buffer-create (format "%s-parsed.txt" filename))))<br />    (goto-line 1 buffer)<br />    (erase-buffer)<br />    (let* ((rss (car parsed-xml))<br />    (channel (xml-get-children rss 'channel))<br />    (items (xml-get-children (car channel) 'item)))<br />      (dolist (item items)<br /> (let ((title (get-item 'title item))<br />       (description (get-item 'description item))<br />       (date (get-item 'pubDate item)))<br />   (insert (format "*%s*\n%s\n%s\n\n" title description date)))))))<br /></pre><br /><br />xml-parse-file is our one shot call to parse the xml file, which returns a nested lisp structure representing the xml document. I grab the channel, then grab any items within the channel and print out three items that I've grabbed from them, the title, description and date. <br /><br />So each item output looks like this:<br /><br />*Obama defends economic stimulus*<br />The US president defends his economic stimulus plan as "absolutely necessary", and urges Congress to approve it quickly.<br />Sat, 07 Feb 2009 22:23:20 GMT<br /><br />Note that if you want to read RSS feeds in emacs, look up the builtin function newsticker. All this information I'm writing about is really useful if you want to code up something custom though.
